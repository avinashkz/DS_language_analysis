---
title: "Data Science Language Analysis"
subtitle: <h1><u>Final Report</u></h1>
author: 
  - "Nazli Ozum Kafaee"
  - "Prash Medirattaa"
  - "Avinash Prabhakaran"
date: '2018-04-15'
output:
  pdf_document:
    number_sections: true
urlcolor: "blue"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source('get_plots.R')
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(cowplot))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(broom))

responses <- read.csv(file = "../docs/survey_results_clean.csv")
```

# Introduction

It is common to hear from people working with data that they have a clear choice between R and Python. Almost everyone who has worked with both R and Python have one or the other as their favorite. We were curious if there might be a specific reason underlying such choice. After some brainstroming, we came up with the hypothesis that a person's choice between R and Python might be due to their preference in a specific data science task such as data visualization, data wrangling and machine learning. This hypothesis was based solely on observations and personal experience, but we set the goal to explore such causal relationship (if there exists one) with data in our data analysis project.

# Methodology

## Data collection

Our primary data source was an online survey created on Google Forms and distributed to the MDS cohort, faculty and teaching assistants through Slack channels as well as to people in the authors' Linkedin and Whatsapp network. In the end, we managed to collect 85 responses.

One of the concerns we had to address was regarding the storage of the collected data. Since we used Google Forms for our survey, the data was hosted in the US. Assuming that a great majority of our respondents were Canadian residents, we made sure to inform them of the fact that the data being collected is hosted in the US and to get their consent before proceeding further in the survey. More information on this matter can be found in the [UBC Office of Research Ethics - Using Online Surveys](https://ethics.research.ubc.ca/sites/ore.ubc.ca/files/documents/Online_Survey-GN.pdf) document.

## Study Design

In our survey, we wanted repondents to answer two main questions: 

- Which of the following programming languages do you prefer more?  
_Possible answers:_ "R" / "Python"  

- What is your favorite data science task?  
_Possible answers:_ "Data wrangling" / "Data visualization" / "Machine Learning"

In the former, respondents were required to choose one of "R" or "Python" and in the latter, they could choose one of three options which were "Data wrangling", "Data visualization" and "Machine Learning". The answers to these two questions would provide us the information for the dependent and independent variables in our analysis, respectively. 

In order to fully discover the causal relationship between task preference and language preference, we also collected data about factors that could have an effect on both of our dependent and independent variable. The primary goal in collecting information on possible confounding variables was to ensure that we can control for these in our analysis later on. We determined five possible confounding variables for which we asked the following questions:

- What is your academic background?    
_Possible answers:_ "Computer Science/Computer Engineering" / "Mathematics/Statistics" / "Other"  

- How many years of coding experience do you have prior to using Python/R?   
_Possible answers:_ "Less than 1" / "1 to 5" / "More than 5"  

- Do you enjoy/love coding?    
_Possible answers:_ "Yes" / "No" / "Indifferent"  

- Which programming language did you learn first?    
_Possible answers:_ "Python" / "R" / "SAS" / "Matlab" / "C" / "Java" / "Other"

- How many programming languages do you use actively?  
_Possible answers:_ "1" / "2" / "3" / "4" / "5 or more"

We thought that academic background would be a confounding variable as people with Computer Science/Computer Engineering background would have been introduced to Python as part of their degree and people from Mathematics/Statistics degrees would have been introduced to R in general. However, we did not anticipate any bias towards R or Python by graduates of any other degrees. We also believed that the amount of coding experience could be a confounder as it can be indicate how open the user is in selecting a statistical programming language over a general-purpose programming language. However, we also realized that it is possible that a user can become highly opinionated when they have greater experience, and they might prefer Python. Therefore, we wanted to include this variable in our survey as it would be interesting to analyze. Another variable we wanted to collect information on was the user's attitude towards coding. The outlook towards coding could be a confounder as Python is a general-purpose programming language and it can be used in various areas, and its application is not limited to Data Science/Statistics whereas R is a statistical programming language and is mainly used only in the fields of Data Science and Statistics. Again, a person's first programming language would be very influential as it dictates their style of coding and would also be a deciding factor in what they seek for in other languages. Some of the programming languages are more closely related to Python whereas some others are more related to R. The number of programming languages a person actively uses could be a deciding factor too as it can dictate how comfortable the user is in using different syntaxes and will also be indicative of how flexible the user.

Our survey can be accessed fully [here](https://goo.gl/forms/zdl0VlHK2NwAfflE3).

## Analysis Methods

The data collected as a result of our survey was downloaded as a `csv` file and imported into R for analysis. All data wrangling and visualization were done in the R computing environment. The code chunks that download data, apply wrangling and create plots can be found in [read_data.R](read_data.R), [clean_data.R](clean_data.R) and [get_plots.R](get_plots.R), respectively.

# Exploratory Data Analysis

## Wrangling

The data collected from the survey required some initial wrangling in order to be prepared for exploratory and statistical data analysis. The main goal in wrangling was to organize answers that came from the "Other" answer option which enabled respondents to freely type their answer for a specific question if their answer did not correspond to any of the answer options we provided. 

The first question in our survey was "What is your academic background?". This question had three main options: "Computer Science / Computer Engineering", "Mathematics / Statistics" and "Other". We saw that "Other" comprised a lot of different answers and made the second highest in terms of share. We decided to split "Other" category and create new categories as we saw that there were some major categories that appeared in these answers but were types differently. Two major categories we observed were engineering and business studies. Therefore, we added "Engineering" and "Business/Economics" as new categories to the academic background variable and left the rest to "Other". Our final categorization of the academic background variable can be seen below together with the distribution of preference between R and Python in each category.

```{r, echo=FALSE, fig.align='center'}
plot_title <- c("Academic Background", "Coding Experience", "User Who Love/Enjoy Coding", "First Programming Language", 
                  "R or Python", "Preferred Data Science Task", "Number of Languages actively Used")

#Academic Background
#proportion_plot(responses[,c(1,5)], 1, plot_title, colnames(responses[,1]))

Text = "A: Computer Science / Computer Engineering, B: Other, \n C: Mathematics / Statistics, D: Business / Economics, \n E: Engineering"

b <- bar_plot(responses[,c(1,5)], plot_title[1]) + xlab("") +
  scale_x_discrete(labels=c("Computer Science / Computer Engineering" = "A", "Other" = "B",
                              "Mathematics / Statistics" = "C", 
                            "Business / Economics" = "D", 
                            "Engineering" = "E")) + 
  theme(axis.text.x = element_text(angle=0, vjust=0.5, size = 12))

ggdraw(add_sub(b, Text, size = 10))
```


We were faced with a similar issue in one of our following questions. When we asked the respondents which programming language they learned first, we gave them six main options to choose from and an "Other" option to fill in if necessary. Again, they could freely type the name of their first programming language if it was not one of the predetermined languages listed by us. We observed that the "Other" option comprised of varying languages but each answer held one or two people and none of the languages that we had not listed represented a major group of people. Therefore, we aggregated all answers in "Other" and kept them together.

## Visualizations

We made use of stacked bar plots in order to see the difference in the preference between R and Python depending on each category in our possible confounding variables. We tried to observe if the variables we had thought to be confounding were really confounding variables.  

As can be seen in the plots below, we have observed that the proportion between the two languages does not change much depending on a person's experience in coding. Again, even though proportions change based on the person's attitude towards coding, this change does not seem to be significant. 


```{r, echo=FALSE, fig.align='center'}
#Coding experience
#proportion_plot(responses[,c(4,5)], 4, plot_title, colnames(responses[,4]))
ce <- bar_plot(responses[,c(2,5)], plot_title[2]) + xlab("")

#Attitude towards coding
#proportion_plot(responses[,c(4,5)], 4, plot_title, colnames(responses[,4]))
ca <- bar_plot(responses[,c(3,5)], plot_title[3]) + xlab("")

#First Programming Language
#proportion_plot(responses[,c(4,5)], 4, plot_title, colnames(responses[,4]))
fl <- bar_plot(responses[,c(4,5)], plot_title[4]) + xlab("")

#Number of Languages Actively Being Used
#proportion_plot(responses[,c(6,5)], 6, plot_title, colnames(responses[,7]))
al <- bar_plot(responses[,c(7,5)], plot_title[7]) + xlab("")

legend <- get_legend(ce)

p1 <- plot_grid(ce + theme(legend.position="none"), 
                ca,
                align = 'h',
           hjust = -1,
           nrow = 1
           )

p2 <- plot_grid(fl + theme(legend.position="none"), 
                al,
                align = 'h',
           hjust = -1,
           nrow = 1
           )

p1
```



```{r, fig.align='center', echo=FALSE}
p2
```

# Statistical Analysis

```{r, echo=FALSE}
#Binary encoding the response variable. Python -> 1; R -> 0 
data <- responses %>% mutate(preference = if_else(preference == "Python", 1, 0))
# data$preference <- as.factor(data$preference)
# data$preference <-relevel(data$preference,ref = 1)
# data$preference <- as.numeric(data$preference)

data$background <- as.character(data$background)
data <- data %>% 
  mutate(background = ifelse(background == "Computer Science / Computer Engineering", "Computer Sc/Eng", 
                              ifelse(background == "Mathematics / Statistics","Maths/Stats", background)))

data$background <- as.factor(data$background)

#Releveling the reference task from Data Viz -> Machine Learning
data_relevel <- data
data_relevel$task <-relevel(data$task,ref="Machine Learning")
```



```{r, eval=FALSE}
#Fitting a GLM without any confounding variables.
model.1 <- glm(preference ~ task, family = binomial(link = 'logit'), data = data)

#Fitting GLM with all the confounding variables.
model.2 <- glm(preference ~ task + background + experience + attitude + first + active, 
               family = binomial(link = 'logit'), data = data)

#Final Model with only first language as confounder
model.3 <- glm(preference ~ task + first, family = binomial(link = 'logit'), data = data)

#Releveling the data to obtain the comparison between Machine Learning and Data Wrangling.
model.4 <- glm(preference ~ task + first, family = binomial(link = 'logit'), 
               data = data_relevel)
```


```{r, echo =FALSE}
#w.r.t Data Viz
model <- glm(preference ~ task + background + first + active,
             family = binomial(link = 'logit'), data = data)
data_base <- broom::tidy(model)
base <- data_base[c(2,3),]

#w.r.t Machine Learning
model_level <- glm(preference ~ task + background + first + active,
             family = binomial(link = 'logit'), data = data_relevel)
data_level <- broom::tidy(model_level)
rebase <- data_level[c(2,3),]

#Combining the 2 results
comb <- bind_rows(base, rebase)

#Adding the reference
comb$reference <- c(rep("Data visualization", 2), rep("Machine learning", 2))

#Extracting the comparison variable
comb <- comb %>% mutate(comparison = sub("task", "", term))

#Removing duplicate comparison between DataViz and Wrangling
final <- comb[-3,]
#Removing row names
rownames(final) <- NULL
#colnames(final)
#final <- final %>% select("comparion", "reference", "estimate", "std.error", "statistic", "p.value")
final <- final %>% select("comparison", "reference", "estimate", "std.error", "p.value")

final <- final %>% mutate(`odds-ratio` = exp(estimate), lowerCI = exp(estimate - 2*std.error), upperCI = exp(estimate + 2*std.error))
```

```{r, echo=FALSE}
broom::tidy(model_level) %>% kable()
```
```{r, echo=FALSE}
model.2 <- glm(preference ~ task + background + experience + attitude + first + active, data = data, family = binomial(link = 'logit'))
```


```{r}
#Feature selection using stepwise
sw_model <- step(model.2, direction = "both", trace=FALSE)
```

**preference ~ task + background + first + active**

# Results

```{r, echo = FALSE}
kable(final)
```

```{r, echo=FALSE, eval=FALSE}
1/0.1736306
```

The people whose favorite task is Data Wrangling are 2.4 times more likely to select Python as their favorite language compared to people whose favorite task is Data Visualization.

The people whose favorite task is Machine Learning are 13.9 times more likely to select Python as their favorite language compared to people whose favorite task is Data Visualization.

People whose favourite task is Data Wrangling are 5.8 times more likely to prefer R as their favourite language compared to people whose favorite task is Machine Learning.

```{r, fig.align='center', echo=FALSE}

final$reference <- c("dviz", "dviz", "ml")
labels <- c(dviz = "Reference - Data Visualization", ml = "Reference - Machine Learning")

final %>% ggplot(aes(comparison, `odds-ratio`, color = reference)) +
  geom_point(size = 3) + geom_errorbar(aes(ymin = lowerCI, ymax = upperCI, color = reference), width = 0.4) +
  scale_y_log10(limits = c(NA,6000)) +
  geom_text(aes(label = round(lowerCI,2), y = lowerCI), vjust = 1.25) +
  geom_text(aes(label = round(upperCI,2), y = upperCI), vjust = -.25) +
  facet_wrap(~reference, labeller = labeller(reference = labels)) +
  labs(title = "Confidence Interval For Odds-Ratio", y = "Odds-Ratio", x = "Comparison") +
  theme(plot.title = element_text(hjust = 0.5, size = 12),
        legend.justification=c(1.1,1.2), legend.position=c(1,1),
        legend.background = element_rect(fill="gray90", size=.5, linetype="dotted")) +
  scale_color_discrete("Reference", breaks = c("dviz", "ml"), labels = c("Data Visualization", "Machine Learning"))


```


# Conclusion

